<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>MPGS Payment</title>

    <!-- Mastercard Hosted Checkout -->
    <script
      src="https://test-gateway.mastercard.com/static/checkout/checkout.min.js"
      data-error="errorCallback"
      data-cancel="cancelCallback"
      data-complete="completeCallback"
    ></script>

    <script>
      function getParam(name) {
        return new URLSearchParams(window.location.search).get(name);
      }

      window.onload = function () {
        const sessionId = getParam("sessionId");
        console.log("Session ID:", sessionId);

        if (!sessionId) {
          alert("Missing sessionId");
          return;
        }

        Checkout.configure({
          session: {
            id: sessionId,
          },
        });

        Checkout.showPaymentPage();
      };

      function errorCallback(error) {
        console.error("MPGS ERROR:", error);

        // Send to React Native
        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(
            JSON.stringify({
              type: "ERROR",
              payload: error,
            })
          );
        }
      }

      function cancelCallback() {
        console.log("Payment cancelled");

        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(
            JSON.stringify({
              type: "CANCEL",
            })
          );
        }
      }

      function completeCallback(result) {
        console.log("Payment complete:", result);

        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(
            JSON.stringify({
              type: "COMPLETE",
              payload: result,
            })
          );
        }
      }
    </script>
  </head>

  <body>
    <h3 style="text-align: center; margin-top: 40px">
      Redirecting to payment...
    </h3>
  </body>
</html>
